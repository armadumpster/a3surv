{
	private _fnc_scriptNameParent = if (isNil '_fnc_scriptName') then {'A3SClient_fnc_object_item_craft'} else {_fnc_scriptName};
	private _fnc_scriptName = 'A3SClient_fnc_object_item_craft';
	scriptName _fnc_scriptName;

#line 1 "A3S_client\bin\scripts\inventory\fn_object_item_craft.sqf [A3SClient_fnc_object_item_craft]"

scriptName"fn_object_item_craft";private["_recipeClassName","_quantityToCraft","_quantityCrafted","_metSideConditions","_recipeConfig","_returnedItems","_interactionModelGroupClassName","_components","_tools","_equippedMagazines","_configSounds","_addedItems","_toolItemClassName","_equippedToolQuantity","_interactionModelGroupModels","_foundObject","_i","_hasAllComponents","_componentQuantity","_componentItemClassName","_equippedComponentQuantity","_returnedItemQuantity","_returnedItemClassName","_feedbackMessage","_returnedItemName","_animations"];if(vehicle player!=player) exitWith{["<t color='#ffff00'>I have to be outside of a car</t>"]call A3SClient_fnc_addToFeed;};if(a3s_inAction) exitWith{["<t color='#ffff00'>Can not make two things at the same time</t>"]call A3SClient_fnc_addToFeed;};a3s_inAction=true;_recipeClassName=_this select 0;_quantityToCraft=_this select 1;_quantityCrafted=0;_metSideConditions=true;_recipeConfig=missionConfigFile>>"CfgCraftingRecipes">>_recipeClassName;_returnedItems=getArray(_recipeConfig>>"returnedItems");_interactionModelGroupClassName=getText(_recipeConfig>>"requiredInteractionModelGroup");_components=getArray(_recipeConfig>>"components");_animations=getArray(_recipeConfig>>"animations");_configSounds=getArray(_recipeConfig>>"sounds");_tools=getArray(_recipeConfig>>"tools");_equippedItems=items player;_equippedMagazines=magazines player;_equippedMagazines append _equippedItems;_addedItems=[];_OnTheGround=false;{_toolItemClassName=_x;_equippedToolQuantity={_x isEqualTo _toolItemClassName}count _equippedMagazines;if(_equippedToolQuantity isEqualTo 0) then {_metSideConditions=false;};}forEach _tools;if(getNumber(_recipeConfig>>"requiresTable") isEqualTo 1) then{if!([ASLtoAGL(getPosASL player),10,["a3s_basebuilding_workbench.p3d"]]call A3SClient_fnc_util_model_isNearby) then {_metSideConditions=false;};};if(getNumber(_recipeConfig>>"requiresWater") isEqualTo 1) then{_interactionModelGroupClassName=getText(_recipeConfig>>"requiredInteractionModelGroup");if!(_interactionModelGroupClassName isEqualTo"") then{_interactionModelGroupConfig=missionConfigFile>>"CfgInteractionModels">>_interactionModelGroupClassName;_interactionModelGroupModels=getArray(_interactionModelGroupConfig>>"models");if!([ASLtoAGL(getPosASL player),5,_interactionModelGroupModels]call A3SClient_fnc_util_model_isNearby) then {_metSideConditions=false;};}else{if!(surfaceIsWater getPosATL player) then{_metSideConditions=false;};};};if(getNumber(_recipeConfig>>"requiresFire") isEqualTo 1) then{if!([player,5]call A3SClient_fnc_util_world_isFireInRange) then {_metSideConditions=false;};};if(_metSideConditions) then{for"_i"from 1 to _quantityToCraft do {_hasAllComponents=true;{_componentQuantity=_x select 0;_componentItemClassName=_x select 1;
_equippedComponentQuantity={_x isEqualTo _componentItemClassName}count _equippedMagazines;if(_equippedComponentQuantity<_componentQuantity) then {_hasAllComponents=false;};}forEach _components;if(_hasAllComponents) then {_spawnOnTheGround=getNumber(_recipeConfig>>"spawnOnTheGround");if(([_components,_returnedItems]call A3SClient_fnc_util_inventory_canExchangeItems) OR(_spawnOnTheGround isEqualTo 1)) then {{_componentQuantity=_x select 0;_componentItemClassName=_x select 1;for"_i"from 1 to _componentQuantity do {player removeItem _componentItemClassName;};}forEach _components;{_returnedItemQuantity=_x select 0;_returnedItemClassName=_x select 1;_addedItems=[_addedItems,_returnedItemClassName,_returnedItemQuantity]call BIS_fnc_addToPairs;_configName=_returnedItemClassName call A3SClient_fnc_util_gear_getConfigNameByClassName;if(_spawnOnTheGround isEqualTo 1) then{for"_i"from 1 to _returnedItemQuantity do {_OnTheGround=true;_weaponHolderPosition=getPosATL player;_weaponHolders=nearestObjects[_weaponHolderPosition,["GroundWeaponHolder"],3];_weaponHolder=objNull;if(_weaponHolders isEqualTo[]) then {_weaponHolder=createVehicle["GroundWeaponHolder",[0,0,0],[],0,"CAN_COLLIDE"];_weaponHolder setPosATL _weaponHolderPosition;}else {_weaponHolder=_weaponHolders select 0;};if(_configName isEqualTo"CfgVehicles") then{_weaponHolder addBackpackCargoGlobal[_returnedItemClassName,1];}else{_weaponHolder addItemCargoGlobal[_returnedItemClassName,1];};};}else{for"_i"from 1 to _returnedItemQuantity do {player addItem _returnedItemClassName;};};}forEach _returnedItems;_quantityCrafted=_quantityCrafted+1;};};};};if(_quantityCrafted>0) then{if!(_animations isEqualTo[]) then {_animation=(selectRandom(_animations));if(_animation isEqualTo"AinvPknlMstpSnonWnonDnon_medic_1") then{for"_i"from 1 to _quantityToCraft do{player playMoveNow _animation;if!(_configSounds isEqualTo[]) then {player say3D(selectRandom(_configSounds));};waitUntil{uisleep 1.4;animationState player!=_animation};if(!a3s_Alive) exitWith{};if(player!=vehicle player) exitWith{};};}else{player playMoveNow _animation;if!(_configSounds isEqualTo[]) then {player say3D(selectRandom(_configSounds));};};}else{if!(_configSounds isEqualTo[]) then {player say3D(selectRandom(_configSounds));};};_feedbackMessage="";{_returnedItemClassName=_x select 0;_returnedItemQuantity=_x select 1;_configName=_returnedItemClassName call A3SClient_fnc_util_gear_getConfigNameByClassName;_returnedItemName=getText(configFile>>_configName>>_returnedItemClassName>>"displayName");if(_feedbackMessage!="") then {_feedbackMessage=_feedbackMessage+"<br/>";};_feedbackMessage=_feedbackMessage+format["+%1x %2",_returnedItemQuantity,_returnedItemName];}forEach _addedItems;a3s_inAction=false;[format["<t color='#A3FB26'>%1</t>",_feedbackMessage]]call A3SClient_fnc_addToFeed;if(_OnTheGround) then{uisleep 1;["<t color='#ffff00'>Look on the ground!</t>"]call A3SClient_fnc_addToFeed;};}else{["<t color='#ffff00'>Need more inventory space!</t>"]call A3SClient_fnc_addToFeed;};true
}